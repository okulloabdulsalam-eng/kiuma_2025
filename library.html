<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library - KIUMA</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#757575">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="js/register-service-worker.js"></script>
    <script>
        // Define showAddBookModal immediately in head so it's available for onclick handlers
        window.showAddBookModal = function() {
            const adminStatus = localStorage.getItem('isAdminLoggedIn') === 'true';
            if (!adminStatus) {
                if (typeof window.showAdminLogin === 'function') {
                    window.showAdminLogin();
                } else {
                    alert('Please login as admin first. Click the "Admin Login" button.');
                }
                return;
            }
            const modal = document.getElementById('addBookModal');
            if (modal) {
                modal.style.display = 'flex';
                modal.style.visibility = 'visible';
                modal.style.zIndex = '9999';
                console.log('Add Book modal opened');
                
                // Re-attach file input handlers when modal opens (fixes timing issues)
                setTimeout(function() {
                    if (typeof window.attachFileInputHandler === 'function') {
                        window.attachFileInputHandler();
                    } else if (typeof attachFileInputHandler === 'function') {
                        attachFileInputHandler();
                    }
                }, 100);
            } else {
                console.error('Add Book modal not found');
                alert('Error: Add Book form not found. Please refresh the page.');
            }
        };
    </script>
</head>
<body>
    <nav class="nav-menu" id="navMenu">
        <div class="nav-header">
            <span class="nav-close" id="navClose"><i class="fas fa-times"></i></span>
        </div>
        <ul class="nav-list">
            <li><a href="index.html" class="nav-link"><i class="fas fa-home"></i> Home</a></li>
            <li><a href="about.html" class="nav-link"><i class="fas fa-info-circle"></i> About</a></li>
            <li><a href="values.html" class="nav-link"><i class="fas fa-heart"></i> Values</a></li>
            <li><a href="programs.html" class="nav-link"><i class="fas fa-book"></i> Programs</a></li>
            <li><a href="quran.html" class="nav-link"><i class="fas fa-quran"></i> Quran</a></li>
            <li><a href="counselling.html" class="nav-link"><i class="fas fa-comments"></i> Counselling</a></li>
            <li><a href="activities.html" class="nav-link"><i class="fas fa-running"></i> Activities</a></li>
            <li><a href="events.html" class="nav-link"><i class="fas fa-calendar-alt"></i> Events</a></li>
            <li><a href="leadership.html" class="nav-link"><i class="fas fa-users"></i> Leadership</a></li>
            <li><a href="contact.html" class="nav-link"><i class="fas fa-phone"></i> Contact</a></li>
            <li><a href="library.html" class="nav-link active"><i class="fas fa-book-open"></i> Library</a></li>
            <li><a href="media.html" class="nav-link"><i class="fas fa-photo-video"></i> Media</a></li>
            <li><a href="ask-question.html" class="nav-link"><i class="fas fa-question-circle"></i> Ask Question</a></li>
            <li><a href="join-programs.html" class="nav-link"><i class="fas fa-user-plus"></i> Join Programs</a></li>
            <li><a href="notifications.html" class="nav-link"><i class="fas fa-bell"></i> Notifications</a></li>
            <li><a href="pay.html" class="nav-link"><i class="fas fa-credit-card"></i> Pay</a></li>
            <li><a href="join-us.html" class="nav-link"><i class="fas fa-hand-holding-heart"></i> Join Us</a></li>
        </ul>
    </nav>

    <div class="container">
        <header class="header">
            <div class="header-content">
                <button class="menu-toggle" id="menuToggle"><i class="fas fa-bars"></i></button>
                <div class="logo-container">
                    <img src="logo.png" alt="KIUMA Logo" class="header-logo" onerror="this.style.display='none'; if(this.nextElementSibling) this.nextElementSibling.style.display='block';" onload="this.style.display='block'; if(this.nextElementSibling) this.nextElementSibling.style.display='none';">
                    <svg class="header-logo-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <circle cx="100" cy="100" r="95" fill="none" stroke="#4CAF50" stroke-width="4"/>
                        <path id="topArc" d="M 20,100 A 80,80 0 0,1 180,100" fill="none"/>
                        <text fill="#4CAF50" font-size="9" font-weight="bold" font-family="Arial, sans-serif" letter-spacing="0.5">
                            <textPath href="#topArc" startOffset="50%" text-anchor="middle">KAMPALA INTERNATIONAL UNIVERSITY</textPath>
                        </text>
                        <path id="bottomArc" d="M 180,100 A 80,80 0 0,1 20,100" fill="none"/>
                        <text fill="#4CAF50" font-size="9" font-weight="bold" font-family="Arial, sans-serif" letter-spacing="0.5">
                            <textPath href="#bottomArc" startOffset="50%" text-anchor="middle">MUSLIM ASSOCIATION</textPath>
                        </text>
                        <path d="M 50,75 L 50,115 L 58,115 L 58,105 L 63,100 L 58,95 L 58,85 Z" fill="none" stroke="#4CAF50" stroke-width="2"/>
                        <circle cx="56.5" cy="100" r="2" fill="#4CAF50"/>
                        <rect x="88" y="65" width="10" height="45" fill="none" stroke="#4CAF50" stroke-width="2"/>
                        <rect x="90" y="75" width="6" height="2" fill="#4CAF50"/>
                        <rect x="90" y="85" width="6" height="2" fill="#4CAF50"/>
                        <rect x="90" y="95" width="6" height="2" fill="#4CAF50"/>
                        <polygon points="93,60 90,65 96,65" fill="#4CAF50"/>
                        <path d="M 140,92 A 12,12 0 0,1 128,92 A 10,10 0 0,0 140,92 Z" fill="#4CAF50"/>
                        <path d="M 130,88 L 131.5,92 L 136,92 L 132.5,94.5 L 134,99 L 130,96.5 L 126,99 L 127.5,94.5 L 124,92 L 128.5,92 Z" fill="#4CAF50"/>
                        <text x="100" y="145" font-size="22" font-weight="bold" fill="#4CAF50" text-anchor="middle" font-family="Arial, sans-serif" letter-spacing="2">KIUMA</text>
                    </svg>
                </div>
                <button class="notifications-btn" id="notificationsBtn">
                    <i class="fas fa-bell"></i>
                    <span class="badge" style="display: none;">0</span>
                </button>
            </div>
        </header>

        <main class="main-content">
            <!-- Welcome Section -->
            <section class="welcome-section">
                <div>
                    <h2 class="greeting">
                        <a href="about.html">KIUMA</a>
                    </h2>
                </div>
                <a href="join-us.html" class="account-icon-btn" id="accountIconBtn">
                    <i class="fas fa-user-circle" id="accountIcon"></i>
                </a>
            </section>

            <section class="page-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                <h2 class="page-title">Library</h2>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-secondary" id="adminLoginBtn" onclick="showAdminLogin()" style="padding: 10px 15px;">
                        <i class="fas fa-lock"></i> Admin Login
                    </button>
                    <button class="btn btn-primary admin-only" onclick="showAddBookModal()" style="display: none; padding: 10px 15px;">
                        <i class="fas fa-plus"></i> Add Book
                    </button>
                    <button class="btn btn-secondary admin-logout" onclick="if(typeof window.logoutAdmin==='function')window.logoutAdmin()" style="display: none; padding: 10px 15px;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </section>

            <section class="page-content">
                <!-- Search Bar with Dropdown Suggestions - At Top -->
                <div style="margin-bottom: 20px; position: relative;">
                    <div style="position: relative;">
                        <input 
                            type="text" 
                            id="librarySearchInput" 
                            placeholder="Search books by name..." 
                            autocomplete="off"
                            style="
                                width: 100%;
                                padding: 14px 50px 14px 16px;
                                font-size: 16px;
                                border: 2px solid #e0e0e0;
                                border-radius: 12px;
                                background: white;
                                box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                                transition: all 0.2s ease;
                                box-sizing: border-box;
                            "
                            oninput="handleLibrarySearchDebounced(this.value)"
                            onfocus="showSearchSuggestions()"
                            onblur="setTimeout(() => hideSearchSuggestions(), 300)"
                            aria-label="Search books by name"
                            aria-autocomplete="list"
                            role="searchbox"
                        />
                        <i class="fas fa-search" style="
                            position: absolute;
                            right: 18px;
                            top: 50%;
                            transform: translateY(-50%);
                            color: #9e9e9e;
                            font-size: 18px;
                            pointer-events: none;
                        "></i>
                    </div>
                    <div id="searchSuggestions" 
                         role="listbox" 
                         aria-label="Search suggestions"
                         style="
                        position: absolute;
                        top: 100%;
                        left: 0;
                        right: 0;
                        background: white;
                        border: 1px solid #e0e0e0;
                        border-radius: 12px;
                        box-shadow: 0 4px 16px rgba(0,0,0,0.1);
                        margin-top: 8px;
                        max-height: 300px;
                        overflow-y: auto;
                        z-index: 1000;
                        display: none;
                    "></div>
                    <div id="searchResultsInfo" style="
                        margin-top: 8px;
                        font-size: 13px;
                        color: #757575;
                        display: none;
                    "></div>
                </div>
                
                <!-- Continue to Books Link -->
                <div style="margin-bottom: 25px;">
                    <div style="display: block; padding: 20px; background: linear-gradient(135deg, #9E9E9E, #757575); color: white; text-decoration: none; border-radius: 15px; text-align: center; font-size: 18px; font-weight: 600; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); opacity: 0.7; pointer-events: none; position: relative;">
                        <i class="fas fa-lock" style="margin-right: 10px;"></i>
                        Continue to Books
                        <div style="position: absolute; top: -10px; right: -10px; background: #F44336; color: white; padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                            <i class="fas fa-tools" style="margin-right: 5px;"></i>
                            Under Maintenance
                        </div>
                    </div>
                    <div style="background: #FFF3CD; border: 1px solid #FFEAA7; border-radius: 8px; padding: 12px; margin-top: 10px;">
                        <p style="margin: 0; color: #856404; font-size: 14px; font-weight: 600;">
                            <i class="fas fa-info-circle" style="margin-right: 8px;"></i>
                            Book management is temporarily unavailable for maintenance.
                        </p>
                        <p style="margin: 5px 0 0 0; color: #856404; font-size: 12px;">
                            Please check back later. You can still view existing books below.
                        </p>
                    </div>
                </div>
                
                <!-- Data Saving Options -->
                <div style="margin-bottom: 30px;">
                    <!-- Option 1: Want to Save Data -->
                    <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); border: 3px solid #2196F3; border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(33, 150, 243, 0.2);">
                        <h3 style="color: #1976D2; font-size: 20px; font-weight: 700; margin: 0 0 15px 0; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-save" style="font-size: 24px;"></i>
                            Option 1: Want to Save Data?
                        </h3>
                        <p style="color: #333; margin: 0 0 15px 0; line-height: 1.6; font-size: 15px;">
                            Contact <strong>0703268522 (Males)</strong> for:
                        </p>
                        <ul style="color: #333; margin: 0 0 20px 0; padding-left: 25px; line-height: 1.8; font-size: 15px;">
                            <li>Books</li>
                            <li>Tafsir Luganda (Sheikh Nkata)</li>
                            <li>Somali</li>
                            <li>All audio lectures (KIUMA mosque)</li>
                            <li>Video on funeral rights</li>
                            <li>Quran apps and settings</li>
                        </ul>
                        <p style="color: #1976D2; font-weight: 600; margin: 0 0 15px 0; font-size: 15px;">
                            <i class="fas fa-truck" style="margin-right: 8px;"></i>
                            Delivery free around Ishaka
                        </p>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <a href="tel:0703268522" style="flex: 1; min-width: 140px; display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 20px; background: #4CAF50; color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: background 0.3s;">
                                <i class="fas fa-phone"></i> Call: 0703268522
                            </a>
                            <a href="https://wa.me/256703268522" target="_blank" style="flex: 1; min-width: 140px; display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 20px; background: #25D366; color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: background 0.3s;">
                                <i class="fab fa-whatsapp"></i> WhatsApp: 0703268522
                            </a>
                        </div>
                    </div>
                    
                    <!-- Option 2: Use Link Below -->
                    <div style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); border: 3px solid #FF9800; border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.2);">
                        <h3 style="color: #F57C00; font-size: 20px; font-weight: 700; margin: 0 0 15px 0; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-link" style="font-size: 24px;"></i>
                            Option 2: Use Link Below to Access All Media
                        </h3>
                        <p style="color: #333; margin: 0; line-height: 1.6; font-size: 15px;">
                            Click the link below to access all media content directly online.
                        </p>
                    </div>
                </div>
                
                <!-- Sort By Dropdown - Very Visible and Clear -->
                <div id="sortByCategorySection" style="margin-bottom: 24px; scroll-margin-top: 20px;">
                    <label for="sortByCategory" style="display: block; margin-bottom: 12px; font-size: 18px; font-weight: 600; color: var(--dark-gray);">
                        <i class="fas fa-filter" style="color: var(--primary-green); margin-right: 8px;"></i>
                        Sort By Category
                    </label>
                    <select id="sortByCategory" style="
                        width: 100%;
                        padding: 18px 20px;
                        font-size: 18px;
                        font-weight: 600;
                        border: 3px solid var(--primary-green);
                        border-radius: 12px;
                        background: linear-gradient(135deg, #ffffff, #f5f5f5);
                        color: var(--dark-gray);
                        cursor: pointer;
                        box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
                        transition: all 0.3s;
                        appearance: none;
                        background-image: url('data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'20\' height=\'20\' viewBox=\'0 0 20 20\'><path fill=\'%234CAF50\' d=\'M5 7l5 5 5-5z\'/></svg>');
                        background-repeat: no-repeat;
                        background-position: right 15px center;
                        background-size: 20px;
                        padding-right: 50px;
                    " onchange="if(typeof window.filterBooks==='function')window.filterBooks(this.value)">
                        <option value="all">üìö All Books (<span id="count-all-display">0</span>)</option>
                        <option value="quran">üìñ Quran (<span id="count-quran-display">0</span>)</option>
                        <option value="yasaruna">üìò Yasaruna (<span id="count-yasaruna-display">0</span>)</option>
                        <option value="hadith">üìó Hadith (<span id="count-hadith-display">0</span>)</option>
                        <option value="tauheed">‚≠ê Tauheed (<span id="count-tauheed-display">0</span>)</option>
                        <option value="swalah">üïå Swalah (<span id="count-swalah-display">0</span>)</option>
                        <option value="others">üìÅ Others (<span id="count-others-display">0</span>)</option>
                    </select>
                    <div style="margin-top: 8px; font-size: 14px; color: #666; text-align: center;">
                        <i class="fas fa-hand-pointer" style="margin-right: 5px;"></i>
                        üëÜ Click here to choose a category
                    </div>
                </div>
                
                <style>
                    /* Sort By Dropdown Styles */
                    #sortByCategory:hover {
                        border-color: #388E3C !important;
                        box-shadow: 0 6px 16px rgba(76, 175, 80, 0.3) !important;
                        transform: translateY(-2px);
                    }
                    #sortByCategory:focus {
                        outline: none;
                        border-color: #388E3C !important;
                        box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4) !important;
                    }
                    
                    /* Book Card Mobile Styles */
                    .book-card {
                        -webkit-tap-highlight-color: transparent;
                    }
                    .book-card:active {
                        transform: scale(0.98) !important;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.15) !important;
                    }
                    
                    .book-details-btn:active,
                    .book-open-btn:active {
                        transform: scale(0.95);
                        opacity: 0.9;
                    }
                    
                    .book-details-btn:hover,
                    .book-open-btn:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(0,0,0,0.2) !important;
                    }
                    
                    /* Mobile-First Document Card Styles */
                    .media-grid {
                        display: grid;
                        grid-template-columns: repeat(2, 1fr);
                        gap: 8px;
                        padding: 0;
                    }
                    
                    /* Mobile form styles */
                    @media (max-width: 767px) {
                        .modal-content {
                            max-width: 100% !important;
                            width: 100% !important;
                            margin: 0 !important;
                            border-radius: 0 !important;
                        }
                        
                        .form-input,
                        .form-group textarea,
                        select.form-input {
                            font-size: 16px !important; /* Prevents zoom on iOS */
                            padding: 16px !important;
                            min-height: 44px !important; /* Large tap target */
                        }
                        
                        .file-upload-button {
                            min-height: 120px !important;
                            padding: 24px 20px !important;
                        }
                        
                        #submitBookBtn {
                            min-height: 52px !important;
                            font-size: 18px !important;
                            padding: 16px !important;
                        }
                    }
                    
                    @media (min-width: 768px) {
                        .media-grid {
                            grid-template-columns: repeat(3, 1fr);
                            gap: 10px;
                        }
                    }
                    
                    @media (min-width: 1024px) {
                        .media-grid {
                            grid-template-columns: repeat(4, 1fr);
                            gap: 12px;
                        }
                    }
                    
                    .media-item {
                        width: 100%;
                        max-width: 100%;
                        min-height: auto;
                    }
                    
                    /* Ultra-Compact Mobile Book Card - Minimal Size */
                    .document-card {
                        width: 100%;
                        background: transparent;
                        border-radius: 10px;
                        box-shadow: none;
                        overflow: visible;
                        transition: all 0.2s ease;
                        -webkit-tap-highlight-color: transparent;
                        cursor: default;
                        border: none;
                        display: flex;
                        flex-direction: column;
                        position: relative;
                        margin-bottom: 4px;
                    }
                    
                    .document-card:active {
                        transform: scale(0.98);
                    }
                    
                    .document-header {
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        padding: 10px 12px;
                        position: relative;
                    }
                    
                    .document-title-section {
                        flex: 1;
                        min-width: 0;
                        padding-right: 8px;
                    }
                    
                    .document-title {
                        font-size: 14px;
                        font-weight: 500;
                        color: #212121;
                        line-height: 1.3;
                        margin: 0 0 4px 0;
                        display: -webkit-box;
                        -webkit-line-clamp: 2;
                        line-clamp: 2;
                        -webkit-box-orient: vertical;
                        overflow: hidden;
                        text-overflow: ellipsis;
                    }
                    
                    .document-category-badge {
                        display: inline-block;
                        padding: 2px 6px;
                        border-radius: 12px;
                        font-size: 10px;
                        font-weight: 600;
                        text-transform: uppercase;
                        letter-spacing: 0.2px;
                        background: #4CAF50;
                        color: white;
                    }
                    
                    .document-body {
                        padding: 0 12px 10px 12px;
                    }
                    
                    .document-description {
                        font-size: 12px;
                        color: #616161;
                        line-height: 1.4;
                        margin: 0;
                        display: -webkit-box;
                        -webkit-line-clamp: 2;
                        line-clamp: 2;
                        -webkit-box-orient: vertical;
                        overflow: hidden;
                        text-overflow: ellipsis;
                    }
                    
                    .document-menu-button {
                        position: absolute;
                        top: 10px;
                        right: 12px;
                        width: 28px;
                        height: 28px;
                        min-width: 28px;
                        min-height: 28px;
                        border-radius: 50%;
                        border: none;
                        background: #f5f5f5;
                        color: #757575;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        transition: all 0.2s ease;
                        z-index: 10;
                        touch-action: manipulation;
                        flex-shrink: 0;
                    }
                    
                    .document-menu-button:active {
                        background: #e0e0e0;
                        transform: scale(0.95);
                    }
                    
                    .document-menu-button i {
                        font-size: 11px;
                    }
                    
                    .document-menu-button.active {
                        background: #2196F3;
                        color: white;
                    }
                    
                    .document-dropdown {
                        position: absolute;
                        top: 34px;
                        right: 12px;
                        background: white;
                        border-radius: 8px;
                        box-shadow: 0 4px 16px rgba(0,0,0,0.15);
                        min-width: 140px;
                        z-index: 1000;
                        opacity: 0;
                        visibility: hidden;
                        transform: translateY(-10px);
                        transition: all 0.2s ease;
                        border: 1px solid #e0e0e0;
                        overflow: hidden;
                    }
                    
                    .document-dropdown.show {
                        opacity: 1;
                        visibility: visible;
                        transform: translateY(0);
                    }
                    
                    .document-dropdown-item {
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        padding: 10px 12px;
                        cursor: pointer;
                        transition: all 0.2s ease;
                        border-bottom: 1px solid #f5f5f5;
                        color: #212121;
                        font-size: 12px;
                        font-weight: 500;
                        text-decoration: none;
                        touch-action: manipulation;
                    }
                    
                    .document-dropdown-item:last-child {
                        border-bottom: none;
                    }
                    
                    .document-dropdown-item:active {
                        background: #f5f5f5;
                    }
                    
                    .document-dropdown-item i {
                        font-size: 12px;
                        width: 16px;
                        text-align: center;
                    }
                    
                    .document-dropdown-item.open i {
                        color: #4CAF50;
                    }
                    
                    .document-dropdown-item.download i {
                        color: #2196F3;
                    }
                    
                    .document-dropdown-item.delete i {
                        color: #f44336;
                    }
                    
                    @media (max-width: 767px) {
                        .document-card {
                            border-radius: 10px;
                            margin-bottom: 4px;
                        }
                        
                        .document-header {
                            padding: 10px 12px;
                        }
                        
                        .document-title {
                            font-size: 14px;
                            padding-right: 36px;
                        }
                        
                        .document-body {
                            padding: 0 12px 10px 12px;
                        }
                        
                        .document-description {
                            font-size: 12px;
                        }
                        
                        .document-menu-button {
                            width: 28px;
                            height: 28px;
                            top: 10px;
                            right: 12px;
                        }
                        
                        .document-menu-button i {
                            font-size: 11px;
                        }
                        
                        .document-dropdown {
                            top: 34px;
                            right: 12px;
                            left: auto;
                            min-width: 140px;
                        }
                        
                        .document-dropdown-item {
                            padding: 10px 12px;
                            font-size: 12px;
                        }
                        
                        .document-dropdown-item i {
                            font-size: 12px;
                            width: 16px;
                        }
                    }
                    
                    /* Compact Card Layout - Force compact styling */
                    .compact-card {
                        padding: 10px !important;
                        min-height: auto !important;
                    }
                    
                    .compact-card * {
                        margin-bottom: 4px !important;
                    }
                    
                    .compact-card .document-card {
                        padding: 0 !important;
                    }
                    
                    .compact-card .document-header {
                        padding: 8px 10px !important;
                    }
                    
                    .compact-card .document-body {
                        padding: 0 10px 8px 10px !important;
                    }
                    
                    .compact-card .icon,
                    .compact-card img,
                    .compact-card svg {
                        width: 32px !important;
                        height: 32px !important;
                        max-height: 32px !important;
                    }
                    
                    .compact-card h3,
                    .compact-card .document-title,
                    .compact-card .title {
                        font-size: 14px !important;
                        margin: 4px 0 !important;
                        line-height: 1.3 !important;
                    }
                    
                    .compact-card p,
                    .compact-card .document-description,
                    .compact-card .description {
                        font-size: 12px !important;
                        line-height: 1.3 !important;
                        margin: 0 !important;
                    }
                    
                    .compact-card .document-category-badge,
                    .compact-card .badge {
                        font-size: 10px !important;
                        padding: 2px 6px !important;
                        margin: 0 !important;
                    }
                    
                    .compact-card .document-menu-button {
                        width: 26px !important;
                        height: 26px !important;
                        padding: 4px !important;
                    }
                    
                    .compact-card .document-dropdown,
                    .compact-card .menu,
                    .compact-card .dropdown,
                    .compact-card .actions {
                        padding: 4px !important;
                    }
                </style>

                <!-- How to Download Box - Collapsible Dropdown -->
                <div style="margin-bottom: 25px;">
                    <button id="downloadInstructionsToggle" onclick="toggleDownloadInstructions()" style="
                        width: 100%;
                        padding: 18px 20px;
                        background: linear-gradient(135deg, #E3F2FD, #BBDEFB);
                        border: 3px solid #2196F3;
                        border-radius: 15px;
                        color: #1976D2;
                        font-size: 20px;
                        font-weight: 700;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        box-shadow: 0 4px 15px rgba(33, 150, 243, 0.2);
                        transition: all 0.3s;
                    ">
                        <span style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-download" style="font-size: 24px;"></i>
                            How to Download Books
                        </span>
                        <i class="fas fa-chevron-down" id="downloadChevron" style="transition: transform 0.3s;"></i>
                    </button>
                    
                    <div id="downloadInstructionsContent" style="
                        display: none;
                        background: linear-gradient(135deg, #E3F2FD, #BBDEFB);
                        border: 3px solid #2196F3;
                        border-top: none;
                        border-radius: 0 0 15px 15px;
                        padding: 20px;
                        box-shadow: 0 4px 15px rgba(33, 150, 243, 0.2);
                        margin-top: -5px;
                    ">
                        <div style="background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                            <h4 style="color: #1976D2; font-size: 16px; font-weight: 600; margin: 0 0 10px 0;">
                                <i class="fas fa-check-circle" style="color: #4CAF50; margin-right: 8px;"></i>
                                Option 1: Direct Download
                            </h4>
                            <ol style="margin: 0; padding-left: 25px; color: #333; line-height: 1.8; font-size: 15px;">
                                <li>Click the <strong>3 dots (‚ãØ)</strong> on the book</li>
                                <li>Click <strong>"Download"</strong></li>
                                <li>Wait for a few seconds - the download will start automatically</li>
                            </ol>
                        </div>
                        
                        <div style="background: white; border-radius: 10px; padding: 15px;">
                            <h4 style="color: #1976D2; font-size: 16px; font-weight: 600; margin: 0 0 10px 0;">
                                <i class="fas fa-check-circle" style="color: #4CAF50; margin-right: 8px;"></i>
                                Option 2: Open Then Download
                            </h4>
                            <ol style="margin: 0; padding-left: 25px; color: #333; line-height: 1.8; font-size: 15px;">
                                <li>Click the <strong>3 dots (‚ãØ)</strong> on the book</li>
                                <li>Click <strong>"Open Document"</strong></li>
                                <li>When it opens in Chrome, click the <strong>3 dots (‚ãØ)</strong> in the <strong>right corner</strong> of Chrome</li>
                                <li>Click <strong>"Download"</strong></li>
                                <li>Click <strong>"Accept"</strong> if asked</li>
                            </ol>
                        </div>
                        
                        <div style="margin-top: 15px; padding: 12px; background: #FFF3CD; border-left: 4px solid #FFC107; border-radius: 8px;">
                            <p style="margin: 0; color: #856404; font-size: 14px; line-height: 1.6;">
                                <i class="fas fa-lightbulb" style="margin-right: 8px;"></i>
                                <strong>Tip:</strong> If download doesn't start, try Option 2. Make sure you have enough storage space on your device.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="media-grid" id="libraryGrid">
                    <!-- Books will be loaded here dynamically -->
                </div>

                <div class="info-card" style="margin-top: 20px;">
                    <h3><i class="fas fa-info-circle"></i> About Our Library</h3>
                    <p>Browse through our collection of Islamic books, educational resources, and Quranic studies materials. All books are carefully selected to support Islamic learning and community education.</p>
                </div>
            </section>
        </main>

        <nav class="bottom-nav">
            <a href="index.html" class="nav-item"><i class="fas fa-home"></i><span>Home</span></a>
            <a href="programs.html" class="nav-item"><i class="fas fa-book"></i><span>Programs</span></a>
            <a href="events.html" class="nav-item"><i class="fas fa-calendar"></i><span>Events</span></a>
            <a href="pay.html" class="nav-item"><i class="fas fa-credit-card"></i><span>Pay</span></a>
            <a href="join-us.html" class="nav-item" id="accountNavItem"><i class="fas fa-user-circle"></i><span id="accountNavText">Account</span></a>
        </nav>
    </div>

    <!-- Floating Important Lessons Button -->
    <div class="floating-lessons-btn" onclick="showLessonsModal()">
        <i class="fas fa-fire"></i>
        <span>Important Lessons</span>
    </div>

    <!-- Floating Kizumu Visit Button -->
    <div class="floating-kizumu-btn" onclick="showActivitiesModal()">
        <i class="fas fa-heart"></i>
        <span>Kizumu Visit</span>
    </div>

    <script src="script.js"></script>
    <script src="update-navigation.js"></script>
    <script>
        // Library Page - Clean and Ready for New Storage Settings
        
        // Mobile-safe function to open book files
        window.openBookFileMobile = function(fileUrl, fileType) {
            if (!fileUrl) {
                showMobileAlert('File URL not available');
                return;
            }
            
            console.log('[Open Book] Opening file:', fileUrl, 'Type:', fileType);
            
            // Detect mobile device
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                            (window.innerWidth <= 768);
            
            // Detect iOS Safari specifically
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const isAndroid = /Android/.test(navigator.userAgent);
            
            // Check if it's a PDF
            const isPDF = fileType === 'pdf' || fileUrl.toLowerCase().includes('.pdf');
            
            if (isMobile) {
                if (isPDF) {
                    // Special handling for PDFs on mobile
                    try {
                        // Method 1: For iOS Safari - use window.open with specific parameters
                        if (isIOS) {
                            console.log('[Open Book] iOS detected, opening PDF in new window');
                            const pdfWindow = window.open('', '_blank');
                            if (pdfWindow) {
                                pdfWindow.location.href = fileUrl;
                                pdfWindow.focus();
                            } else {
                                window.location.href = fileUrl;
                            }
                        }
                        // Method 2: For Android - use window.open with noopener
                        else if (isAndroid) {
                            console.log('[Open Book] Android detected, opening PDF');
                            const pdfWindow = window.open(fileUrl, '_blank', 'noopener,noreferrer');
                            if (!pdfWindow || pdfWindow.closed || typeof pdfWindow.closed === 'undefined') {
                                window.location.href = fileUrl;
                            }
                        }
                    } catch (error) {
                        console.error('[Open Book] Error opening PDF:', error);
                        window.location.href = fileUrl;
                    }
                } else {
                    // For non-PDF files on mobile, use direct navigation
                    window.location.href = fileUrl;
                }
            } else {
                // Desktop: open in new tab
                window.open(fileUrl, '_blank', 'noopener,noreferrer');
            }
        };
        
        // Initialize library page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[Library] Page initialized - ready for new storage settings');
            
            // Show maintenance message
            const libraryGrid = document.getElementById('libraryGrid');
            if (libraryGrid) {
                libraryGrid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 80px 20px; color: #999;">
                        <div style="max-width: 400px; margin: 0 auto;">
                            <i class="fas fa-database" style="font-size: 80px; margin-bottom: 30px; opacity: 0.4; color: var(--primary-green);"></i>
                            <h3 style="margin: 0 0 15px 0; color: #666; font-size: 24px; font-weight: 300;">Library Storage</h3>
                            <p style="margin: 0 0 20px 0; font-size: 16px; line-height: 1.6; color: #888;">
                                The library system is being updated with new storage settings. 
                                Please check back later for access to our book collection.
                            </p>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 20px;">
                                <p style="margin: 0; font-size: 14px; color: #666;">
                                    <i class="fas fa-info-circle" style="color: var(--primary-green); margin-right: 8px;"></i>
                                    <strong>Status:</strong> Configuration in progress
                                </p>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Check admin status
            const adminStatus = localStorage.getItem('isAdminLoggedIn') === 'true';
            if (adminStatus) {
                console.log('[Library] Admin user detected');
                // Admin functions will be available when storage is configured
            }
        });
        
        // Placeholder functions for future storage integration
        window.loadLibraryBooks = function() {
            console.log('[Library] Load books function called - storage not yet configured');
        };
        
        window.addLibraryBook = function(bookData) {
            console.log('[Library] Add book function called - storage not yet configured');
        };
        
        window.deleteLibraryBook = function(bookId) {
            console.log('[Library] Delete book function called - storage not yet configured');
        };
        
        // Admin functions (ready for future integration)
        window.showAddBookModal = function() {
            showMobileAlert('Add book function will be available when storage is configured.');
        };
        
        window.deleteBook = function(bookId) {
            showMobileAlert('Delete book function will be available when storage is configured.');
        };
        
        // Search and filter functions (ready for future integration)
        window.searchLibraryBooks = function(searchTerm) {
            console.log('[Library] Search function called:', searchTerm);
        };
        
        window.filterLibraryByCategory = function(category) {
            console.log('[Library] Filter function called:', category);
        };
        
        console.log('[Library] Clean initialization complete - ready for new storage configuration');
    </script>
</body>
</html>
